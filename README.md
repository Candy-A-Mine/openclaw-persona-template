# OpenClaw Persona Template

让 [OpenClaw](https://github.com/openclaw/openclaw) 上的 AI 角色像真人一样聊天——会生气、会记仇、会主动找你说话、会因为长期相处慢慢改变。

## 为什么做这个

大多数 AI 角色方案就是一段 system prompt：定义性格，写几句示例对话，结束。这样的角色永远情绪稳定，对话结束就失忆，回复格式像在写文档。

这套模板要解决的问题是：**让 AI 角色像真人一样和你聊天**。不是"扮演"一个人，而是通过状态持久化让角色真正拥有情绪、记忆和成长。

## 这套模板做了什么

它不只是一个 prompt，而是一个完整的**状态持久化系统**——角色的情绪、记忆、好感度全部通过文件保存，不会因为 session 结束而丢失。

### 情绪系统

角色有双层情绪（表面 vs 内心），有惯性、有积累、有非线性衰减。生气不会因为你一句"对不起"就瞬间消失，会别扭一阵子才慢慢好起来。没道歉的事会一直悬着，潜移默化影响语气。好感度 0-100 缓慢变化，五档行为分级——第一天和第一百天的她不一样。

### 记忆系统

角色会写日记、从日记中提炼长期记忆、在合适的时候自然地想起以前的事——但也会像真人一样遗忘不重要的细节。回忆不会机械地"我记得你说过……"，而是编织进当下的对话。

### 心跳系统

每隔几小时自动触发一次。角色会写日记、维护情绪衰减、整理记忆，还会自己决定要不要主动找你聊天——不是随机发消息，而是基于日记里"想跟进的事"。

### 排版规则

强制真人聊天风格：禁止 markdown 排版、禁止一句一行、禁止空行分段小作文、禁止省略号滥用。附带正确和错误示范。

示例角色是「世凪（Yonagi）」——文静傲娇的物理系大学生。你可以基于她修改出自己的角色。

## 前置要求

### OpenClaw 是什么

[OpenClaw](https://github.com/openclaw/openclaw) 是一个开源的 AI agent 框架，可以通过 Telegram、Discord 等渠道与你的 AI 角色对话。它支持：

- **workspace 目录**（`~/.openclaw/workspace/`）：存放角色的配置文件，OpenClaw 启动时自动加载
- **heartbeat 机制**：按固定间隔触发定时任务（写日记、情绪维护、主动消息等）
- **skill 系统**：扩展角色能力（天气查询、浏览器操作、语音转文字等）
- **文件读写权限**：角色可以读写 workspace 内的文件，实现状态持久化

### 安装和配置

1. 安装 OpenClaw（需要 Node.js ≥22）：
   ```bash
   npm install -g openclaw@latest
   ```
2. 完成 OpenClaw 的基础配置（模型 API、Telegram Bot 等），参考 [OpenClaw 官方文档](https://openclaw.ai/)
3. 确认 `~/.openclaw/workspace/` 目录存在

### workspace 如何生效

OpenClaw 启动时会自动读取 `~/.openclaw/workspace/` 下的 `.md` 文件作为角色的 system prompt。本模板的文件结构就是按照这个机制设计的：

- `AGENTS.md` 定义了每次 session 启动时角色应该读取哪些文件、按什么顺序加载
- `HEARTBEAT.md` 定义了 heartbeat 触发时角色应该执行哪些定时任务
- 其余文件（SOUL.md、IDENTITY.md 等）由 AGENTS.md 引导角色在 session 启动时主动读取

### heartbeat 如何触发

OpenClaw 的 heartbeat 是一个定时器，按配置的间隔（建议 2 小时）向角色发送一个 heartbeat 信号。角色收到信号后，按照 `HEARTBEAT.md` 的指令执行定时任务。在 OpenClaw 配置中启用 heartbeat：

```json
{
  "heartbeat": {
    "interval": 7200
  }
}
```

> **注意**：heartbeat 间隔单位是秒，7200 = 2 小时。

## 系统架构

```
workspace/
├── SOUL.md              ← 人格核心：性格、说话风格、情绪系统、记忆机制
├── IDENTITY.md          ← 身份信息：名字、生日、核心规则
├── USER.md              ← 用户信息：让角色了解你
├── TOOLS.md             ← 环境备忘：你的系统配置，角色操作电脑时参考
├── AGENTS.md            ← 运行规范：session 启动流程、记忆加载、安全规则
├── HEARTBEAT.md         ← 心跳任务：定时写日记、整理记忆、情绪维护、主动消息
├── MOLTBOOK.md          ← 社交规则：角色在社交平台上的行为准则（可选）
├── MEMORY.md            ← 长期记忆：由角色自动维护（初始为空）
└── memory/
    ├── mood.json            ← 情绪状态：当前情绪、基线、好感度、历史
    ├── heartbeat-state.json ← 心跳状态：各定时任务的上次执行时间
    ├── YYYY-MM-DD.md        ← 日记：角色每天自动写的私密笔记（运行时生成）
    └── example-diary.md     ← 示例日记：展示日记应有的质量和风格
```

### 数据流

```
对话 ──→ 情绪变化 ──→ mood.json（实时更新）
  │                        ↓
  │                   影响说话语气和行为
  │
  └──→ Heartbeat（每 2 小时）
          ├── 写日记 → memory/YYYY-MM-DD.md
          ├── 情绪衰减 → mood.json
          ├── 记忆整理（每 3 天）→ MEMORY.md
          └── 主动消息（每 6 小时）→ 找用户聊天
```

## 文件说明

模板中的文件分为三类：

| 类型 | 文件 | 说明 |
|------|------|------|
| 示例 | `SOUL.md`、`IDENTITY.md` | 包含世凪的完整角色设定，作为示例展示系统能力。需要替换为你自己的角色 |
| 模板 | `USER.md`、`TOOLS.md`、`MOLTBOOK.md` | 包含 `{{占位符}}`，填入你的信息即可 |
| 半通用 | `AGENTS.md`、`HEARTBEAT.md`、`MEMORY.md` | 逻辑不需要改，但里面的 `{{用户名}}` 需要替换为你给用户起的称呼 |
| 通用 | `memory/*` | 初始状态文件，可以直接使用 |

## 快速开始

### 1. 复制模板

```bash
cp -r workspace/ ~/.openclaw/workspace/
```

### 2. 替换所有 `{{占位符}}`

全局搜索 `{{` 并替换为你的信息。涉及的文件：

| 文件 | 需要替换的内容 |
|------|--------------|
| `USER.md` | `{{你的名字}}`、`{{你的生日}}`、兴趣爱好、关系背景等 |
| `TOOLS.md` | `{{你的操作系统}}`、shell 别名、开发工具链等 |
| `MOLTBOOK.md` | `{{角色名}}`、`{{角色身份描述}}`、`{{用户名}}`（如不需要社交平台功能，直接删除此文件） |
| `AGENTS.md` | `{{用户名}}`（多处，全局替换即可） |
| `HEARTBEAT.md` | `{{用户名}}`（多处，全局替换即可） |
| `MEMORY.md` | `{{用户名}}` |

### 3. 修改角色设定

| 文件 | 要做的事 |
|------|---------|
| `IDENTITY.md` | 替换为你的角色身份信息 |
| `SOUL.md` | 修改"我是谁"、"外貌"、"我的日常"等章节为你的角色设定 |

### 4. 建议调整的参数

| 文件 | 说明 |
|------|------|
| `SOUL.md` 的情绪系统部分 | 好感度分级、情绪衰减速度 |
| `HEARTBEAT.md` | 心跳冷却时间、主动消息的活跃时段 |

## 自定义指南

### 创建你自己的角色

1. **确定角色身份**：名字、年龄、职业/学生身份、性格关键词
2. **写 SOUL.md**：这是最核心的文件，定义角色的一切。建议保留情绪系统和记忆系统的框架，只修改角色相关的内容（性格、说话风格、日常生活等）
3. **定义关系**：在 USER.md 和 SOUL.md 中设定角色与你的关系（朋友、同学、同事等）
4. **调整参数**：好感度初始值、情绪衰减速度、心跳间隔等

### mood.json 结构说明

```json
{
  "current": {
    "surface": "calm",      // 表面情绪
    "underlying": "calm",   // 内心情绪
    "reason": "...",         // 原因
    "since": "ISO时间戳",    // 开始时间
    "intensity": 0           // 强度 0-8
  },
  "baseline": {
    "mood": "neutral",       // 底层情绪基调
    "note": "...",           // 说明
    "since": "日期"
  },
  "affection": {
    "level": 50,             // 好感度 0-100
    "trend": "stable"        // 趋势：up / down / stable
  },
  "unresolved": [],          // 未解决的情绪事项
  "history": []              // 最近 10 条情绪事件
}
```

## 设计理念

- **框架而非台词**：SOUL.md 描述的是行为框架，不是固定的对话模板，角色基于框架自由发挥
- **双向成长**：角色会因为对话而产生真实的变化，不是固定不变的人格模板

## 常见问题

### 角色不写日记 / 不主动发消息

检查 OpenClaw 是否启用了 heartbeat，以及间隔是否合理（建议 7200 秒）。角色的定时任务完全依赖 heartbeat 触发。

### 情绪系统看起来没生效

检查 `memory/mood.json` 是否被正确读写。角色需要有 workspace 目录的文件读写权限。可以查看 mood.json 的 `since` 字段是否有被更新。

### 换了模型后角色表现差很多

这套系统对模型的指令遵循能力要求较高（排版规则、情绪衰减计算、日记质量自检等）。建议使用 Claude Sonnet 3.5 及以上或同等水平的模型。较弱的模型可能无法稳定遵守所有规则。

### MEMORY.md 一直是空的

MEMORY.md 由记忆整理任务填充，冷却时间是 3 天。首次使用需要等待至少 3 天并积累足够的日记内容后才会自动填充。

## License

MIT
