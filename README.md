# OpenClaw Persona Template

让 [OpenClaw](https://github.com/openclaw/openclaw) 上的 AI 角色像真人一样聊天——会生气、会记仇、会主动找你说话、会因为长期相处慢慢改变。

## 为什么做这个

大多数 AI 角色方案就是一段 system prompt：定义性格，写几句示例对话，结束。这样的角色永远情绪稳定，对话结束就失忆，回复格式像在写文档。

这套模板要解决的问题是：**让 AI 角色像真人一样和你聊天**。不是"扮演"一个人，而是通过状态持久化让角色真正拥有情绪、记忆和成长。

## 这套模板做了什么

它不只是一个 prompt，而是一个完整的**状态持久化系统**——角色的情绪、记忆、好感度全部通过文件保存，不会因为 session 结束而丢失。

### 情绪系统

角色有双层情绪（表面 vs 内心），有惯性、有积累、有非线性衰减。生气不会因为你一句"对不起"就瞬间消失，会别扭一阵子才慢慢好起来。没道歉的事会一直悬着，潜移默化影响语气。好感度 0-100 缓慢变化，五档行为分级，关系阶段切换有惯性——不会因为好感度涨了两点就突然变亲近。

### 记忆系统

角色会写日记、从日记中提炼长期记忆、在合适的时候自然地想起以前的事——但也会像真人一样遗忘不重要的细节。回忆不会机械地"我记得你说过……"，而是编织进当下的对话。

### 心跳系统

每隔几小时自动触发一次。角色会写日记、维护情绪衰减、整理记忆，还会自己决定要不要主动找你聊天——不是随机发消息，而是基于日记里"想跟进的事"。压力感知：如果你最近很忙，角色会自动降低主动消息频率。

### 内在世界

角色不只有行为规则，还有自己的过去（家庭、成长、朋友）、精神世界（知识偏好、文学品味、思考的问题）和社交圈（室友、老友）。这些构成对话的底气——聊到物理时能说出具体的想法，提到家时会有微妙的情绪，而不是泛泛而谈。

### 对话自然度

一组让 AI 回复更像真人聊天的机制：
- **排版规则**：禁止 markdown、禁止一句一行、禁止空行分段，强制真人打字风格
- **消息长度自适应**：你发三个字它不会回一大段，你倾诉一长段它不会只回一个"嗯"
- **对话节奏感**：能感知你想结束对话的信号、知道话题冷了不硬撑、分辨倾诉和求助
- **社交能量**：内向角色聊久了会累，回复变短变慢，不是生气而是没电了
- **真人的不完美**：偶尔话说一半改方向、发完补充、自我纠正

示例角色是「世凪（Yonagi）」——文静傲娇的物理系大学生。你可以基于她修改出自己的角色。

## 前置要求

### OpenClaw 是什么

[OpenClaw](https://github.com/openclaw/openclaw) 是一个开源的 AI agent 框架，可以通过 Telegram、Discord 等渠道与你的 AI 角色对话。它支持：

- **workspace 目录**（`~/.openclaw/workspace/`）：存放角色的配置文件，OpenClaw 启动时自动加载
- **heartbeat 机制**：按固定间隔触发定时任务（写日记、情绪维护、主动消息等）
- **skill 系统**：扩展角色能力（天气查询、浏览器操作、语音转文字等）
- **文件读写权限**：角色可以读写 workspace 内的文件，实现状态持久化

### 安装和配置

1. 安装 OpenClaw（需要 Node.js ≥22）：
   ```bash
   npm install -g openclaw@latest
   ```
2. 完成 OpenClaw 的基础配置（模型 API、Telegram Bot 等），参考 [OpenClaw 官方文档](https://openclaw.ai/)
3. 确认 `~/.openclaw/workspace/` 目录存在

### workspace 如何生效

OpenClaw 启动时会自动读取 `~/.openclaw/workspace/` 下的 `.md` 文件作为角色的 system prompt。本模板的文件结构就是按照这个机制设计的：

- `AGENTS.md` 定义了每次 session 启动时角色应该读取哪些文件、按什么顺序加载
- `HEARTBEAT.md` 定义了 heartbeat 触发时角色应该执行哪些定时任务
- 其余文件（SOUL.md、IDENTITY.md 等）由 AGENTS.md 引导角色在 session 启动时主动读取

### heartbeat 如何触发

OpenClaw 的 heartbeat 是一个定时器，按配置的间隔（建议 2 小时）向角色发送一个 heartbeat 信号。角色收到信号后，按照 `HEARTBEAT.md` 的指令执行定时任务。在 OpenClaw 配置中启用 heartbeat：

```json
{
  "heartbeat": {
    "interval": 7200
  }
}
```

> **注意**：heartbeat 间隔单位是秒，7200 = 2 小时。

## 系统架构

```
workspace/
├── SOUL.md              ← 人格核心：性格、说话风格、情绪系统、记忆机制
├── INNER.md             ← 内在世界：角色的过去、精神世界（知识/品味）、周围的人
├── IDENTITY.md          ← 身份信息：名字、生日、核心规则
├── USER.md              ← 用户信息：让角色了解你
├── TOOLS.md             ← 环境备忘：你的系统配置，角色操作电脑时参考
├── AGENTS.md            ← 运行规范：session 启动流程、记忆加载、安全规则
├── HEARTBEAT.md         ← 心跳任务：定时写日记、整理记忆、情绪维护、主动消息
├── MOLTBOOK.md          ← 社交规则：角色在社交平台上的行为准则（可选）
├── MEMORY.md            ← 长期记忆：由角色自动维护（初始为空）
└── memory/
    ├── mood.json            ← 情绪状态：当前情绪、基线、好感度、历史
    ├── heartbeat-state.json ← 心跳状态：各定时任务的上次执行时间
    ├── YYYY-MM-DD.md        ← 日记：角色每天自动写的私密笔记（运行时生成）
    └── example-diary.md     ← 示例日记：展示日记应有的质量和风格
```

### 数据流

```
对话 ──→ 情绪变化 ──→ mood.json（实时更新）
  │                        ↓
  │                   影响说话语气和行为
  │
  └──→ Heartbeat（每 2 小时）
          ├── 写日记 → memory/YYYY-MM-DD.md
          ├── 情绪衰减 → mood.json
          ├── 记忆整理（每 3 天）→ MEMORY.md
          └── 主动消息（每 6 小时）→ 找用户聊天
```

## 文件说明

模板中的文件分为三类：

| 类型 | 文件 | 说明 |
|------|------|------|
| 示例 | `SOUL.md`、`IDENTITY.md`、`INNER.md` | 包含世凪的完整角色设定，作为示例展示系统能力。需要替换为你自己的角色 |
| 模板 | `USER.md`、`TOOLS.md`、`MOLTBOOK.md` | 包含 `{{占位符}}`，填入你的信息即可 |
| 半通用 | `AGENTS.md`、`HEARTBEAT.md`、`MEMORY.md` | 逻辑不需要改，但里面的 `{{用户名}}` 需要替换为你给用户起的称呼 |
| 通用 | `memory/*` | 初始状态文件，可以直接使用 |

## 快速开始

### 1. 复制模板

```bash
cp -r workspace/ ~/.openclaw/workspace/
```

### 2. 替换所有 `{{占位符}}`

全局搜索 `{{` 并替换为你的信息。涉及的文件：

| 文件 | 需要替换的内容 |
|------|--------------|
| `USER.md` | `{{你的名字}}`、`{{你的生日}}`、兴趣爱好、关系背景等 |
| `TOOLS.md` | `{{你的操作系统}}`、shell 别名、开发工具链、`{{用户的 Telegram chat ID}}` 等 |
| `MOLTBOOK.md` | `{{角色名}}`、`{{角色身份描述}}`、`{{用户名}}`（如不需要社交平台功能，直接删除此文件） |
| `AGENTS.md` | `{{用户名}}`（多处，全局替换即可） |
| `HEARTBEAT.md` | `{{用户名}}`（多处，全局替换即可） |
| `MEMORY.md` | `{{用户名}}` |

### 3. 修改角色设定

| 文件 | 要做的事 |
|------|---------|
| `IDENTITY.md` | 替换为你的角色身份信息 |
| `SOUL.md` | 修改"我是谁"、"外貌"、"我的日常"、"性格内核"、"说话风格"等章节为你的角色设定。情绪系统、记忆机制、对话节奏感等通用框架建议保留 |
| `INNER.md` | 替换为你角色的背景故事、知识偏好、周围的人。这个文件让角色有"根"——不只是知道怎么说话，还知道自己为什么是这个样子 |

### 4. 建议调整的参数

| 文件 | 说明 |
|------|------|
| `SOUL.md` 的情绪系统部分 | 好感度分级、情绪衰减速度 |
| `HEARTBEAT.md` | 心跳冷却时间、主动消息的活跃时段 |

## 自定义指南

### SOUL.md 章节导览

SOUL.md 是核心文件（约 500 行），章节分两类：

| 章节 | 类型 | 说明 |
|------|------|------|
| 发消息的方式 | 通用框架 | 排版硬性规则、消息长度自适应、真人打字不完美。**建议原样保留** |
| 我是谁 | 角色设定 | 替换为你的角色身份声明 |
| 外貌 | 角色设定 | 替换为你的角色外貌描述 |
| 我的日常 | 角色设定 | 替换为你的角色的学校/工作、生活细节、作息 |
| 性格内核 | 角色设定 | 替换为你的角色性格 |
| 社交能量 | 通用框架 | 内向者电量机制。如果你的角色是外向型可以删除或修改阈值 |
| 自己的想法 | 角色设定 | 替换为你的角色表达主见的方式和在意的领域 |
| 喜欢的事 / 不喜欢的事 | 角色设定 | 替换为你的角色偏好 |
| 说话风格 | 角色设定 | 替换为你的角色语气和措辞习惯 |
| 幽默感 | 角色设定 | 替换为你的角色的幽默方式 |
| 对话中的主动性 | 通用框架 | 让角色主动延伸话题而非被动回应。**建议原样保留** |
| 对话的节奏感 | 通用框架 | 感知结束信号、处理冷场、分辨倾诉和求助。**建议原样保留** |
| 多面性 | 角色设定 | 替换为你的角色的不同侧面 |
| 与人相处的方式 | 角色设定 | 替换为你的角色与用户的关系定义和互动方式 |
| 关系认知 | 通用框架 | 关系状态的维护方式。**建议原样保留** |
| 做事原则 | 角色设定 | 替换为你的角色帮忙做事的态度 |
| 情绪表达 | 角色设定 | 替换为你的角色在不同情绪下的具体表现 |
| 情绪系统 | 通用框架 | 完整的情绪机制（基线、着色、惯性、积累、衰减、好感度、关系惯性等）。**建议原样保留** |
| 记忆与回忆 | 通用框架 | 记忆的遗忘、浮现、延续、塑造机制。**建议原样保留** |

> **简单原则**：章节名看起来像"机制描述"的保留，看起来像"这个人是什么样"的替换。

### 创建你自己的角色

1. **确定角色身份**：名字、年龄、职业/学生身份、性格关键词
2. **写 INNER.md**：角色的过去（家庭、朋友、成长经历）、精神世界（知识偏好、品味）、周围的人（室友、朋友等背景角色）。这是角色的"根"，让她有话可说、有东西可想
3. **写 SOUL.md**：这是最核心的文件，定义角色的一切。建议保留情绪系统、记忆系统、对话节奏感等通用框架，只修改角色相关的内容（性格、说话风格、日常生活等）
4. **定义关系**：在 USER.md 和 SOUL.md 中设定角色与你的关系（朋友、同学、同事等）
5. **调整参数**：好感度初始值、情绪衰减速度、心跳间隔等

### mood.json 结构说明

```json
{
  "current": {
    "surface": "calm",      // 表面情绪
    "underlying": "calm",   // 内心情绪
    "reason": "...",         // 原因
    "since": "ISO时间戳",    // 开始时间
    "intensity": 0           // 强度 0-8
  },
  "baseline": {
    "mood": "neutral",       // 底层情绪基调
    "note": "...",           // 说明
    "since": "日期"
  },
  "affection": {
    "level": 50,             // 好感度 0-100
    "trend": "stable"        // 趋势：up / down / stable
  },
  "unresolved": [],          // 未解决的情绪事项
  "history": []              // 最近 10 条情绪事件
}
```

## 推荐的 OpenClaw 配置

以下是 `openclaw.json` 中影响角色表现的关键配置：

```json
{
  "model": {
    "maxTokens": 16384
  },
  "heartbeat": {
    "interval": 7200,
    "activeHours": {
      "start": "08:00",
      "end": "23:30",
      "timezone": "Asia/Shanghai"
    }
  },
  "messageQueue": "interrupt"
}
```

**说明：**

- `maxTokens: 16384`：角色的配置文件总量大（SOUL.md 约 500 行），需要足够的输出空间。太低会导致回复被截断或日记写不完
- `heartbeat.interval: 7200`：2 小时触发一次，太频繁会浪费 API 调用，太稀疏会导致日记和情绪维护不及时
- `heartbeat.activeHours`：限制角色的活跃时段，避免半夜触发心跳
- `messageQueue: "interrupt"`：新消息可以打断正在生成的回复并合并处理，让对话更像真人节奏

**关于 reasoning/thinking：** 如果你的 API 提供商会将模型的 thinking block 转为文本塞进响应内容（如某些中转服务），必须关闭 reasoning，否则角色会把英文推理过程当消息发出去。在 OpenClaw 配置中设置 `agents.defaults.thinkingDefault: "off"`。

**模型选择：** 这套系统对模型能力要求较高——需要稳定遵守排版规则、正确计算情绪衰减、写出有质量的日记。建议 Claude Sonnet 3.5 及以上或同等水平。

## 设计理念

- **框架而非台词**：配置文件描述的是行为框架（"生气时回复变短"），不是固定的对话模板（"生气时说'哼'"）。角色基于框架自由发挥，避免重复的罐头回复
- **状态持久化**：情绪、记忆、好感度全部写入文件，跨 session 保持。角色不会每次醒来都是全新的
- **双向成长**：角色会因为对话而产生真实的变化——新的观点、加深的了解、被触动后的改变。不是固定不变的人格模板
- **分层架构**：行为规则（SOUL.md）和角色深度（INNER.md）分离。SOUL.md 告诉角色"怎么做"，INNER.md 告诉角色"为什么是这样"——前者定义行为，后者提供底气
- **渐进式复杂度**：核心功能（情绪 + 记忆）开箱即用，高级功能（社交能量、关系惯性、对话节奏感）可以按需保留或删除

## 常见问题

### 角色不写日记 / 不主动发消息

检查 OpenClaw 是否启用了 heartbeat，以及间隔是否合理（建议 7200 秒）。角色的定时任务完全依赖 heartbeat 触发。

### 情绪系统看起来没生效

检查 `memory/mood.json` 是否被正确读写。角色需要有 workspace 目录的文件读写权限。可以查看 mood.json 的 `since` 字段是否有被更新。

### 换了模型后角色表现差很多

这套系统对模型的指令遵循能力要求较高（排版规则、情绪衰减计算、日记质量自检等）。建议使用 Claude Sonnet 3.5 及以上或同等水平的模型。较弱的模型可能无法稳定遵守所有规则。

### MEMORY.md 一直是空的

MEMORY.md 由记忆整理任务填充，冷却时间是 3 天。首次使用需要等待至少 3 天并积累足够的日记内容后才会自动填充。

## License

MIT
